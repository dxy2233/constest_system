INSERT INTO `gr_setting` (`id`, `group`, `name`, `key`, `value`, `default`, `type`, `initialize`, `remark`, `status`, `sort`, `create_time`, `update_time`) VALUES        (29,	'vote',	'倒计时显示功能开关',	'count_down_is_open',	'1',	'1',	'radio',	'',	'开关',	1,	4,	0,	0);
UPDATE `gr_setting` SET `sort` = '5' WHERE `id` = '10';
UPDATE `gr_setting` SET `sort` = '6' WHERE `id` = '11';
UPDATE `gr_setting` SET `sort` = '7' WHERE `id` = '13';
UPDATE `gr_setting` SET `sort` = '8' WHERE `id` = '24';
ALTER TABLE `gr_voucher` ADD `give_user_id` int(11) NOT NULL COMMENT '赠送人ID(被推荐人)' AFTER `user_id`;
ALTER TABLE `gr_voucher` ADD `type` int(11) NOT NULL COMMENT '派发类型' AFTER `voucher_num`;
ALTER TABLE `gr_voucher` ADD `remark` varchar(256) COLLATE 'utf8_general_ci' NOT NULL COMMENT '备注' AFTER `type`;

INSERT INTO `gr_setting` (`id`, `group`, `name`, `key`, `value`, `default`, `type`, `initialize`, `remark`, `status`, `sort`, `create_time`, `update_time`) VALUES        (30,	'vote',	'支付投票赠送GDT',	'pay_gdt',	'2',	'2',	'input',	'',	'GDT',	1,	6,	0,	0);
INSERT INTO `gr_setting` (`id`, `group`, `name`, `key`, `value`, `default`, `type`, `initialize`, `remark`, `status`, `sort`, `create_time`, `update_time`) VALUES        (31,	'vote',	'支付投票投中奖励',	'pay_reward',	'0.1',	'0.1',	'input',	'',	'GDT',	1,	7,	0,	0);
INSERT INTO `gr_setting` (`id`, `group`, `name`, `key`, `value`, `default`, `type`, `initialize`, `remark`, `status`, `sort`, `create_time`, `update_time`) VALUES        (32,	'vote',	'持有投票赠送GDT',	'ordinary_gdt',	'0.03',	'0.03',	'input',	'',	'GDT',	1,	9,	0,	0);
INSERT INTO `gr_setting` (`id`, `group`, `name`, `key`, `value`, `default`, `type`, `initialize`, `remark`, `status`, `sort`, `create_time`, `update_time`) VALUES        (33,	'vote',	'持有投票投中奖励',	'ordinary_reward',	'0.01',	'0.01',	'input',	'',	'GDT',	1,	10,	0,	0);
INSERT INTO `gr_setting` (`id`, `group`, `name`, `key`, `value`, `default`, `type`, `initialize`, `remark`, `status`, `sort`, `create_time`, `update_time`) VALUES        (34,	'vote',	'投票券投中奖励',	'voucher_reward',	'0.004',	'0.004',	'input',	'',	'GDT',	1,	11,	0,	0);
UPDATE `gr_setting` SET `sort` = '8' WHERE `id` = '11';
UPDATE `gr_setting` SET `status` = '0' WHERE `id` = '13';
UPDATE `gr_setting` SET `status` = '0' WHERE `id` = '14';
UPDATE `gr_setting` SET `status` = '0' WHERE `id` = '24';
UPDATE `gr_setting` SET `status` = '0' WHERE `id` = '4';
UPDATE `gr_setting` SET `status` = '0' WHERE `id` = '21';

CREATE TABLE `gr_cycle` (
`id` int(11) NOT NULL AUTO_INCREMENT,
`cycle_start_time` int(11) NOT NULL COMMENT '竞选开始时间',
`cycle_end_time` int(11) NOT NULL COMMENT '竞选截止时间',
`tenure_start_time` int(11) NOT NULL COMMENT '任职时间',
`tenure_end_time` int(11) NOT NULL COMMENT '到期时间',
`create_time` int(11) NOT NULL,
`update_time` int(11) NOT NULL,
PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='投票周期表';


/* Alter table in target */
ALTER TABLE `gr_node_type` 
ADD `gdt_reward` decimal(18,8)  NOT NULL COMMENT '奖励GDT数量' AFTER `bpt`,
CHANGE `max_candidate` `max_candidate` int(11)   NOT NULL COMMENT '候选人上限' after `gdt_reward` ;

/* Alter table in target */
ALTER TABLE `gr_user_currency_detail` 
CHANGE `type` `type` tinyint(3)   NOT NULL DEFAULT 0 COMMENT '类型，1 收款 2 提现  4 投票 5 手续费 6奖励' after `currency_id` ;

/* Alter table in target */
ALTER TABLE `gr_vote` 
CHANGE `type` `type` tinyint(4) unsigned   NOT NULL COMMENT '投标类型 1持有2支付3券4推荐' after `consume` ;

/* Alter table in target */
ALTER TABLE `gr_voucher` 
CHANGE `node_id` `node_id` int(11)   NOT NULL COMMENT '赠送人节点ID' after `give_user_id` , 
CHANGE `voucher_num` `voucher_num` int(11)   NOT NULL COMMENT '投票券数量' after `node_id` , 
CHANGE `create_time` `create_time` int(11)   NOT NULL after `remark` ;


ALTER TABLE `gr_cycle`
CHANGE `cycle_start_time` `cycle_start_time` int(11) NOT NULL DEFAULT '0' COMMENT '竞选开始时间' AFTER `id`,
CHANGE `cycle_end_time` `cycle_end_time` int(11) NOT NULL DEFAULT '0' COMMENT '竞选截止时间' AFTER `cycle_start_time`,
CHANGE `tenure_start_time` `tenure_start_time` int(11) NOT NULL DEFAULT '0' COMMENT '任职时间' AFTER `cycle_end_time`,
CHANGE `tenure_end_time` `tenure_end_time` int(11) NOT NULL DEFAULT '0' COMMENT '到期时间' AFTER `tenure_start_time`,
CHANGE `create_time` `create_time` int(11) NOT NULL DEFAULT '0' AFTER `tenure_end_time`,
CHANGE `update_time` `update_time` int(11) NOT NULL DEFAULT '0' AFTER `create_time`;

ALTER TABLE `gr_history`
CHANGE `node_id` `node_id` int(11) NOT NULL DEFAULT '0' COMMENT '节点ID' AFTER `id`,
CHANGE `node_type` `node_type` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '节点类型ID' AFTER `node_id`,
CHANGE `username` `username` varchar(64) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '用户名' AFTER `node_type`,
CHANGE `node_name` `node_name` char(64) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '节点名' AFTER `username`,
CHANGE `vote_number` `vote_number` int(11) NOT NULL DEFAULT '0' COMMENT '票数' AFTER `node_name`,
CHANGE `people_number` `people_number` int(11) NOT NULL DEFAULT '0' COMMENT '支持人数' AFTER `vote_number`,
CHANGE `is_tenure` `is_tenure` tinyint(4) NOT NULL DEFAULT '1' COMMENT '0:未任职 1:已任职' AFTER `people_number`,
CHANGE `update_number` `update_number` varchar(16) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '0' COMMENT '更新次数' AFTER `is_tenure`,
CHANGE `create_time` `create_time` int(11) NOT NULL DEFAULT '0' AFTER `update_number`;

ALTER TABLE `gr_node`
CHANGE `user_id` `user_id` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '用户ID' AFTER `id`,
CHANGE `type_id` `type_id` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '节点类型ID' AFTER `user_id`,
CHANGE `name` `name` varchar(255) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '机构/名称' AFTER `type_id`,
CHANGE `grt` `grt` int(11) NOT NULL DEFAULT '0' COMMENT '质压grt' AFTER `name`,
CHANGE `tt` `tt` int(11) NOT NULL DEFAULT '0' COMMENT '质压tt' AFTER `grt`,
CHANGE `bpt` `bpt` int(11) NOT NULL DEFAULT '0' COMMENT '质压bpt' AFTER `tt`,
CHANGE `desc` `desc` text COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '简介' AFTER `bpt`,
CHANGE `scheme` `scheme` text COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '建设方案' AFTER `desc`,
CHANGE `examine_time` `examine_time` int(11) NOT NULL DEFAULT '0' COMMENT '审核时间' AFTER `logo`,
CHANGE `create_time` `create_time` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '创建时间' AFTER `examine_time`;

ALTER TABLE `gr_node_rule`
CHANGE `name` `name` varchar(128) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '权限名称' AFTER `id`,
CHANGE `content` `content` text COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '权限内容' AFTER `name`,
CHANGE `is_tenure` `is_tenure` tinyint(4) NOT NULL DEFAULT '0' COMMENT '是否任职' AFTER `content`,
CHANGE `create_time` `create_time` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '添加时间' AFTER `is_tenure`;

ALTER TABLE `gr_node_type`
CHANGE `name` `name` varchar(16) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '节点名' AFTER `id`,
CHANGE `grt` `grt` decimal(18,8) NOT NULL DEFAULT '0' COMMENT 'GRT最小量' AFTER `name`,
CHANGE `tt` `tt` decimal(18,8) NOT NULL DEFAULT '0' COMMENT 'TT最小量' AFTER `grt`,
CHANGE `bpt` `bpt` decimal(18,8) NOT NULL DEFAULT '0' COMMENT 'BPT最小量' AFTER `tt`,
CHANGE `gdt_reward` `gdt_reward` decimal(18,8) NOT NULL DEFAULT '0' COMMENT '奖励GDT数量' AFTER `bpt`,
CHANGE `max_candidate` `max_candidate` int(11) NOT NULL DEFAULT '0' COMMENT '候选人上限' AFTER `gdt_reward`,
CHANGE `create_time` `create_time` int(11) NOT NULL DEFAULT '0' AFTER `sort`;

ALTER TABLE `gr_notice`
CHANGE `title` `title` varchar(255) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '标题' AFTER `id`,
CHANGE `desc` `desc` varchar(255) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '描述' AFTER `title`,
CHANGE `detail` `detail` text COLLATE 'utf8_general_ci' NULL DEFAULT '' COMMENT '详情' AFTER `desc`,
CHANGE `image` `image` varchar(255) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '展示图' AFTER `type`,
CHANGE `url` `url` varchar(255) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '链接地址' AFTER `image`,
CHANGE `is_top` `is_top` tinyint(3) unsigned NOT NULL DEFAULT '0' COMMENT '是否置顶' AFTER `sort`,
CHANGE `status` `status` tinyint(3) unsigned NOT NULL DEFAULT '0' COMMENT '状态：0 下架 1 上架 2 删除' AFTER `is_top`,
CHANGE `start_time` `start_time` int(11) unsigned NULL DEFAULT '0' COMMENT '开始时间' AFTER `status`,
CHANGE `end_time` `end_time` int(11) unsigned NULL DEFAULT '0' COMMENT '结束时间' AFTER `start_time`,
CHANGE `click` `click` bigint(20) NOT NULL DEFAULT '0' COMMENT '点击量' AFTER `end_time`,
CHANGE `create_time` `create_time` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '创建时间' AFTER `click`,
CHANGE `update_time` `update_time` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '修改时间' AFTER `create_time`;

ALTER TABLE `gr_type_rule_contrast`
CHANGE `type_id` `type_id` int(11) NOT NULL DEFAULT '0' COMMENT '分类ID' AFTER `id`,
CHANGE `min_order` `min_order` int(11) NOT NULL DEFAULT '0' COMMENT '最小排名' AFTER `type_id`,
CHANGE `max_order` `max_order` int(11) NOT NULL DEFAULT '0' COMMENT '最大排名' AFTER `min_order`,
CHANGE `is_tenure` `is_tenure` tinyint(4) NOT NULL DEFAULT '0' COMMENT '权限种 类 1：2 排名 1：任职 0：候选' AFTER `max_order`,
CHANGE `rule_id` `rule_id` int(11) NOT NULL DEFAULT '0' COMMENT '权限ID' AFTER `is_tenure`,
CHANGE `create_time` `create_time` int(11) NOT NULL DEFAULT '0' AFTER `rule_id`;

ALTER TABLE `gr_user_recommend`
CHANGE `user_id` `user_id` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '用户ID' AFTER `id`,
CHANGE `parent_id` `parent_id` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '推荐人ID' AFTER `user_id`,
CHANGE `amount` `amount` int(11) NOT NULL DEFAULT '0' COMMENT '投票数量' AFTER `node_id`,
CHANGE `create_time` `create_time` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '推荐时间' AFTER `amount`;

ALTER TABLE `gr_user_voucher`
CHANGE `user_id` `user_id` int(11) NOT NULL DEFAULT '0' COMMENT '用户ID' AFTER `id`,
CHANGE `position_amount` `position_amount` int(11) NOT NULL DEFAULT '0' COMMENT '持券总量' AFTER `user_id`,
CHANGE `surplus_amount` `surplus_amount` int(11) NOT NULL DEFAULT '0' COMMENT '剩余数量' AFTER `position_amount`,
CHANGE `use_amount` `use_amount` int(11) NOT NULL DEFAULT '0' COMMENT '使用数量' AFTER `surplus_amount`,
CHANGE `create_time` `create_time` int(11) NOT NULL DEFAULT '0' AFTER `use_amount`,
CHANGE `update_time` `update_time` int(11) NOT NULL DEFAULT '0' AFTER `create_time`;

ALTER TABLE `gr_vote`
CHANGE `user_id` `user_id` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '用户ID' AFTER `id`,
CHANGE `node_id` `node_id` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '节点ID' AFTER `user_id`,
CHANGE `vote_number` `vote_number` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '投票数量' AFTER `node_id`,
CHANGE `type` `type` tinyint(4) unsigned NOT NULL DEFAULT '1' COMMENT '投标类型 1持有2支付3券4推荐' AFTER `consume`,
CHANGE `create_time` `create_time` int(11) unsigned NOT NULL DEFAULT '0' AFTER `undo_time`;

ALTER TABLE `gr_voucher`
CHANGE `user_id` `user_id` int(11) NOT NULL DEFAULT '0' COMMENT '用户ID' AFTER `id`,
CHANGE `give_user_id` `give_user_id` int(11) NOT NULL DEFAULT '0' COMMENT '赠送人ID(被推荐人)' AFTER `user_id`,
CHANGE `node_id` `node_id` int(11) NOT NULL DEFAULT '0' COMMENT '赠送人节点ID' AFTER `give_user_id`,
CHANGE `voucher_num` `voucher_num` int(11) NOT NULL DEFAULT '0' COMMENT '投票券数量' AFTER `node_id`,
CHANGE `type` `type` tinyint(4) NOT NULL DEFAULT '0' COMMENT '派发类型' AFTER `voucher_num`,
CHANGE `remark` `remark` varchar(256) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '备注' AFTER `type`,
CHANGE `create_time` `create_time` int(11) NOT NULL DEFAULT '0' AFTER `remark`;

ALTER TABLE `gr_voucher_detail`
CHANGE `user_id` `user_id` int(11) NOT NULL DEFAULT '0' COMMENT '用户ID' AFTER `id`,
CHANGE `node_id` `node_id` int(11) NOT NULL DEFAULT '0' COMMENT '节点ID' AFTER `user_id`,
CHANGE `vote_id` `vote_id` int(11) NOT NULL DEFAULT '0' COMMENT '投票记录ID' AFTER `node_id`,
CHANGE `amount` `amount` int(11) NOT NULL DEFAULT '0' COMMENT '使用数量' AFTER `vote_id`,
CHANGE `create_time` `create_time` int(11) NOT NULL DEFAULT '0' COMMENT '创建时间' AFTER `amount`;

以上sql 2018-11-07 20:00已同步线上
=============================================================

ALTER TABLE `gr_node_type`
ADD `quota` decimal(12,2) NOT NULL DEFAULT '0' COMMENT '销售配额' AFTER `gdt_reward`;

ALTER TABLE `gr_node`
ADD `quota` decimal(12,2) NULL COMMENT '配额' AFTER `scheme`;

CREATE TABLE `gr_user_other` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL DEFAULT '0' COMMENT '用户ID',
  `consignee` varchar(64) NOT NULL DEFAULT '' COMMENT '收货人姓名',
  `consignee_mobile` varchar(32) NOT NULL DEFAULT '' COMMENT '收货人电话',
  `area_province_id` int(11) NOT NULL DEFAULT '0' COMMENT '省级ID',
  `area_city_id` int(11) NOT NULL DEFAULT '0' COMMENT '市级ID',
  `address` varchar(128) NOT NULL DEFAULT '' COMMENT '详细地址',
  `zip_code` int(11) NOT NULL DEFAULT '0' COMMENT '邮编',
  `weixin` varchar(128) NOT NULL DEFAULT '' COMMENT '微信号',
  `recommend_mobile` varchar(32) NOT NULL DEFAULT '' COMMENT '推荐人手机号',
  `recommend_name` varchar(32) NOT NULL DEFAULT '' COMMENT '推荐人姓名',
  `grt_address` varchar(256) NOT NULL DEFAULT '' COMMENT '贵人通地址',
  `tt_address` varchar(256) NOT NULL DEFAULT '' COMMENT '茶通地址',
  `bpt_address` varchar(256) NOT NULL DEFAULT '' COMMENT '美食通地址',
  `create_time` int(11) NOT NULL DEFAULT '0',
  `update_time` int(11) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='用户其它信息表';

INSERT INTO `gr_sms_template` (`name`, `type`, `content`, `language`, `status`, `outer_template_id`, `create_time`)
VALUES ('节点通过-通知', '5', '尊敬的用户，您申请的${name}节点已通过审核，请前往个人中心编辑您的节点和添加收货地址，感谢您的支持。', 'zh-CN', '1', NULL, '0');

ALTER TABLE `gr_user_other`
CHANGE `zip_code` `zip_code` varchar(10) NOT NULL DEFAULT '' COMMENT '邮编' AFTER `address`;

以上sql 2018-11-14 12:00已同步线上
=============================================================

# 新增管理员电话号码
INSERT INTO `gr_setting`(`group`, `name`, `key`, `value`, `default`, `type`, `initialize`, `remark`, `status`, `sort`, `create_time`, `update_time`) VALUES ('sms', '实名认证发送管理员', 'sms_admin', '18083609005,15285147616,15985124797', '0', 'input', '', '前端实名认证后发送短信通知管理员', 0, 0, 0, 0);
# 新增短信模板
INSERT INTO `gr_sms_template`(`name`, `type`, `content`, `language`, `status`, `outer_template_id`, `create_time`) VALUES ('实名认证审核', 6, '亲爱的管理员，已有用户提交了实名认证，请尽快审核', 'zh-CN', 1, '', 0);

以上sql 2018-11-15 14:30已同步线上
=============================================================


CREATE TABLE `gr_update_log` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `table_name` varchar(64) NOT NULL COMMENT '表名',
  `field_name` varchar(64) NOT NULL COMMENT '字段名',
  `new_data` text NOT NULL COMMENT '新数据',
  `old_data` text NOT NULL COMMENT '旧数据',
  `data_id` int(11) NOT NULL COMMENT '数据ID',
  `create_time` int(11) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='数据修改记录';


CREATE TABLE `gr_update_data` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `mobile` varchar(32) NOT NULL COMMENT '手机',
  `grt` decimal(18,8) NOT NULL COMMENT '贵人通',
  `tt` decimal(18,8) NOT NULL COMMENT '茶通',
  `bpt` decimal(18,8) NOT NULL COMMENT '美食通',
  `status` tinyint(4) NOT NULL DEFAULT 0 COMMENT '执行状态',
  `create_time` int(11) NOT NULL DEFAULT 0,
  `update_time` int(11) NOT NULL DEFAULT 0,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='节点质押数量修改原始数据';

ALTER TABLE `gr_node`
ADD `update_time` int(11) unsigned NOT NULL DEFAULT '0';

以上sql 2018-11-16 17:15已同步线上
=============================================================

# 替换 gr_user_currency_detail 中 "充币/提币" 字样 更改为 "转入积分/转出积分"
UPDATE `gr_contest`.`gr_user_currency_detail` SET `remark` = REPLACE(`remark`, '充币','转入积分');
UPDATE `gr_contest`.`gr_user_currency_detail` SET `remark` = REPLACE(`remark`, '提币','转出积分');

#添加用户上级字段
ALTER TABLE `gr_user`
ADD `parent_list` text NULL COMMENT '上级列表' AFTER `status`;
#上级字段类型修改
ALTER TABLE `gr_user`
CHANGE `parent_list` `parent_list` varchar(1000) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '上级ID列表' AFTER `status`;


以上sql 2018-11-27 17:10已同步线上
=============================================================

ALTER TABLE `gr_admin_user`
ADD `role_id` int NOT NULL COMMENT '角色ID' AFTER `department`;


#修改 id 为 1的管理员权限为 1
UPDATE `gr_admin_user` SET `role_id` = '1' WHERE `gr_admin_user`.`id` = 1;
UPDATE `gr_admin_user` SET `role_id` = '2' WHERE `gr_admin_user`.`id` != 1;

CREATE TABLE `gr_admin_rule` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `url` text COMMENT '路由地址',
  `name` varchar(64) NOT NULL DEFAULT '' COMMENT '权限名称',
  `parent_id` int(11) NOT NULL DEFAULT '0' COMMENT '上级权限ID',
  `create_time` int(11) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='管理员权限表';

#需复制gr_admin_rule整表数据

CREATE TABLE `gr_admin_role` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(64) NOT NULL DEFAULT '' COMMENT '角色名',
  `rule_list` text COMMENT '权限列表',
  `status` tinyint(4) NOT NULL DEFAULT '1' COMMENT '状态 0：禁用 1：启用',
  `create_time` int(11) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='角色表';


ALTER TABLE `gr_admin_user`
CHANGE `real_name` `real_name` varchar(45) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '姓名' AFTER `password`,
CHANGE `email` `email` varchar(45) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '邮箱' AFTER `real_name`,
CHANGE `department` `department` varchar(45) COLLATE 'utf8_general_ci' NOT NULL DEFAULT '' COMMENT '部门' AFTER `email`,
CHANGE `role_id` `role_id` int(11) NOT NULL DEFAULT '1' COMMENT '角色ID' AFTER `department`;

INSERT INTO `gr_admin_role` (`id`, `name`, `rule_list`, `status`, `create_time`) VALUES
(1,	'超级管理员',	'[1,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]',	1,	1542787323),
(2,	'成员',	NULL,	1,	0);

以上sql 2018-12-05 17:00已同步线上
=============================================================

ALTER TABLE `gr_user_recommend`
ADD `parent_list` varchar(1000) NOT NULL DEFAULT '' COMMENT '上级列表' AFTER `node_id`;

ALTER TABLE `gr_user_recommend`
ADD UNIQUE `user_id` (`user_id`),
DROP INDEX `user_id`;

# 转移 层级关系字段数据到 user_recommend表中
update gr_user a join gr_user_recommend b on a.id = b.user_id set b.parent_list = a.parent_list;

# 删除user 表中的 层级关系字段
ALTER TABLE `gr_user` DROP `parent_list`;

CREATE TABLE `gr_node_recommend` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `user_id` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '用户ID',
  `parent_id` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '推荐人ID',
  `node_id` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '被推荐人节点ID',
  `parent_list` varchar(1000) NOT NULL DEFAULT '' COMMENT '上级列表',
  `amount` int(11) NOT NULL DEFAULT '0' COMMENT '投票数量',
  `create_time` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '推荐时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `user_id` (`user_id`),
  KEY `parent_id` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='用户推荐关系表';

#节点申请表结构
CREATE TABLE `gr_node_upgrade` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `user_id` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '用户ID',
  `name` varchar(256) NOT NULL COMMENT '节点名称',
  `logo` varchar(256) NOT NULL DEFAULT '' COMMENT 'LOGO',
  `desc` text NOT NULL COMMENT '简介',
  `scheme` text NOT NULL COMMENT '建设方案',
  `weixin` varchar(128) NOT NULL COMMENT '微信号',
  `old_type` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '提交前类型',
  `type_id` int(11) unsigned NOT NULL COMMENT '节点类型',
  `parent_id` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '补录推荐人ID',
  `status` tinyint(4) unsigned NOT NULL DEFAULT '0' COMMENT '审核状态 0 待审核 1 已审核 2 审核失败',
  `status_remark` varchar(255) NOT NULL DEFAULT '' COMMENT '状态备注',
  `grt` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '质押grt',
  `grt_address` varchar(256) NOT NULL DEFAULT '' COMMENT '贵人通地址',
  `tt` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '质押tt',
  `tt_address` varchar(256) NOT NULL DEFAULT '' COMMENT '茶通地址',
  `bpt` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '质押bpt',
  `bpt_address` varchar(256) NOT NULL DEFAULT '' COMMENT '美食通地址',
  `examine_time` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '审核时间',
  `create_time` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '创建时间',
  `update_time` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '修改时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=385 DEFAULT CHARSET=utf8 COMMENT='节点升级记录表';

#节点预定系统转移微店节点
CREATE TABLE `gr_node_extend` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL DEFAULT '' COMMENT '节点名称',
  `type_id` int(10) unsigned NOT NULL DEFAULT '5' COMMENT '节点类型ID',
  `type_name` varchar(255) NOT NULL DEFAULT '微店节点' COMMENT '节点类型名称',
  `quota` decimal(12,2) unsigned NOT NULL DEFAULT '0.00' COMMENT '节点配额',
  `mobile` varchar(20) NOT NULL DEFAULT '' COMMENT '节点手机号',
  `status` tinyint(3) unsigned NOT NULL DEFAULT '0' COMMENT '节点状态 0 未激活 1 已激活 2 停用',
  `company` varchar(255) NOT NULL DEFAULT '' COMMENT '所属公司',
  `create_time` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '创建时间',
  `update_time` int(11) unsigned NOT NULL DEFAULT '0' COMMENT '修改时间',
  PRIMARY KEY (`id`),
  KEY `quota` (`quota`),
  KEY `mobile` (`mobile`),
  KEY `status` (`status`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8 COMMENT='节点预定系统转移微店节点';

ALTER TABLE `gr_node_type`
ADD `conversion` int NOT NULL COMMENT '三通折合grt数量' AFTER `name`;

INSERT INTO `gr_admin_rule` (`id`, `url`, `name`, `parent_id`, `create_time`) VALUES 
(40,	'node/examine-upgrade',	'节点升级列表',	0,	0),
(41,	'node/examine-on,node/examine-off',	'节点升级审核',	40,	0);


INSERT INTO `gr_sms_template` (`name`, `type`, `content`, `language`, `status`, `outer_template_id`, `create_time`)
VALUES ('节点升级通过-通知', '7', '尊敬的用户，您的${name}节点升级审核已通过，感谢您的支持。', 'zh-CN', '1', NULL, '0');

INSERT INTO `gr_node_type` (`id`, `name`, `conversion`, `grt`, `tt`, `bpt`, `gdt_reward`, `quota`, `max_candidate`, `is_examine`, `is_candidate`, `is_vote`, `is_order`, `tenure_num`, `status`, `sort`, `create_time`) VALUES
(5,	'微店节点',	0.00000000,	0.00000000,	0.00000000,	0.00000000,	0.00000000,	82000.00,	1000,	1,	1,	0,	0,	1000,	1,	50,	0);

ALTER TABLE `gr_admin_rule`
ADD `sort` int(11) NOT NULL COMMENT '排序' AFTER `parent_id`;

delete from gr_admin_rule;

INSERT INTO `gr_admin_rule` (`id`, `url`, `name`, `parent_id`, `sort`, `create_time`) VALUES
(1,	'statistics/index,statistics/get-statistics-data,statistics/get-address-data',	' 统计报表',	0,	0,	0),
(2,	'user/index,user/get-user-info,user/get-address,user/get-user-identify,user/get-user-vote,user/get-currency,user/get-user-voucher,user/get-user-recommend',	' 用户管理',	0,	1,	0),
(3,	'node/index,node/get-node-data,node/get-address,node/get-node-identify,node/get-vote-list,node/get-rule',	'节点管理',	0,	2,	0),
(4,	'vote/index',	'投票管理',	0,	3,	0),
(5,	'finance/index',	'资产管理',	0,	4,	0),
(6,	'finance/get-finance-list',	'财务流水',	0,	5,	0),
(7,	'notice/index,notice/get-detail',	'公告管理',	0,	6,	0),
(8,	'node/examine',	'节点审核',	0,	7,	0),
(9,	'identify/index,identify/detail',	'实名认证',	0,	9,	0),
(10,	'withdraw/index,withdraw/wallet-info',	'转账审核',	0,	10,	0),
(11,	'manager/get-admin-list',	'成员列表',	0,	11,	0),
(12,	'user/create-user',	'新增用户',	2,	0,	0),
(13,	'user/edit-user,user/stop-user,user/open-user',	'用户编辑',	2,	0,	0),
(14,	'user/get-give-info,user/get-recommend-list,user/give',	'派发奖励',	2,	0,	0),
(15,	'user/download',	'导出excel',	2,	0,	0),
(16,	'node/create-user,node/check-mobile,node/check-node',	'新增节点',	3,	0,	0),
(17,	'node/update-node,node/open-node,node/stop-node,node/un-tenure,node/tenure',	'节点编辑',	3,	0,	0),
(18,	'node/get-history-order',	'查看排名',	3,	0,	0),
(19,	'node/set-rule,node/update',	'节点设置',	3,	0,	0),
(20,	'node/download,node/history-download',	'导出excel',	3,	0,	0),
(21,	'vote/get-vote-order',	'查看排名',	4,	0,	0),
(22,	'cycle/create-cycle,cycle/update-cycle,cycle/del,cycle/index,cycle/history,cycle/get-setting,cycle/set-setting',	'竞选设置',	4,	0,	0),
(23,	'vote/get-setting-list,vote/set-vote',	'投票设置',	4,	0,	0),
(24,	'vote/download,vote/vote-order-download',	'导出excel',	4,	0,	0),
(25,	'finance/get-frozen-list',	'锁仓记录',	5,	0,	0),
(26,	'finance/download,finance/frozen-download',	'导出excel',	5,	0,	0),
(27,	'finance/finance-download',	'导出excel',	6,	0,	0),
(28,	'notice/create',	'发布公告',	7,	0,	0),
(29,	'notice/edit,notice/del-notice,notice/on-shelf,notice/off-shelf,notice/set-top,notice/set-un-top',	'公告编辑',	7,	0,	0),
(30,	'notice/get-setting-list,notice/set-notice',	'公告设置',	7,	0,	0),
(31,	'node/examine-on,node/examine-off,node/del-old-data',	'审核操作',	8,	0,	0),
(32,	'identify/examine-on,identify/examine-off',	'审核操作',	9,	0,	0),
(33,	'withdraw/examine-on,withdraw/examine-off',	'审核操作',	10,	0,	0),
(34,	'withdraw/get-setting-list,withdraw/set-vote',	'转账设置',	10,	0,	0),
(35,	'manager/set-role-rule,manager/create-role',	'编辑权限',	38,	0,	0),
(36,	'manager/edit-role,manager/create-admin,manager/edit-admin',	'成员编辑',	11,	0,	0),
(37,	'log/index',	'操作日志',	0,	12,	0),
(38,	'manager/get-role-list',	'权限设置',	0,	13,	0),
(39,	'log/download',	'日志导出',	37,	0,	0),
(40,	'node/examine-upgrade',	'节点升级列表',	0,	8,	0),
(41,	'node/examine-on,node/examine-off',	'节点升级审核',	40,	0,	0);

# 执行控制台 
# 重建 node_recommend 数据
# php yii index/create-node-recommend 
# 补录历史节点申请数据
# php yii index/create-old-upgrade 

# 将导入的微信节点type_id 更改为 5
update gr_node_extend set type_id = 5;

#索引优化
ALTER TABLE `gr_user_access_token`
ADD INDEX `expire_time` (`expire_time`);

ALTER TABLE `gr_vote`
ADD INDEX `undo_time` (`undo_time`);

ALTER TABLE `gr_user_currency_detail`
ADD INDEX `create_time` (`create_time`);

ALTER TABLE `gr_user`
ADD INDEX `create_time` (`create_time`);

以上sql 2018-12-29 14:00已同步线上
=============================================================

ALTER TABLE `gr_node_upgrade`
ADD `old_grt` int(11) NOT NULL DEFAULT 0 COMMENT '升级时grt' AFTER `grt_address`;
ALTER TABLE `gr_node_upgrade`
ADD `old_tt` int(11) NOT NULL DEFAULT 0 COMMENT '升级时grt' AFTER `old_grt`;
ALTER TABLE `gr_node_upgrade`
ADD `old_bpt` int(11) NOT NULL DEFAULT 0 COMMENT '升级时grt' AFTER `old_tt`;

CREATE TABLE `gr_node_transfer` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `from_user_id` int(11) NOT NULL DEFAULT '0' COMMENT '转出用户',
  `to_user_id` int(11) NOT NULL DEFAULT '0' COMMENT '转入用户',
  `node_id` int(11) NOT NULL DEFAULT '0' COMMENT '节点ID',
  `images` varchar(1000) NOT NULL DEFAULT '' COMMENT '申请凭证',
  `status` tinyint(4) NOT NULL DEFAULT '0' COMMENT '审核状态 0',
  `status_remark` varchar(128) NOT NULL DEFAULT '' COMMENT '状态备注',
  `create_time` int(11) NOT NULL DEFAULT '0' COMMENT '创建时间',
  `node_type` int(11) NOT NULL DEFAULT '0' COMMENT '节点类型',
  `grt` decimal(18,8) NOT NULL DEFAULT '0.00000000' COMMENT '转让时grt数量',
  `tt` decimal(18,8) NOT NULL DEFAULT '0.00000000' COMMENT '转让时tt数量',
  `bpt` decimal(18,8) NOT NULL DEFAULT '0.00000000' COMMENT '转让时tt数量',
  `examine_time` int(11) NOT NULL DEFAULT '0' COMMENT '审核时间',
  `examine_user` int(11) NOT NULL DEFAULT '0' COMMENT '审核管理员',
  `update_time` int(11) NOT NULL DEFAULT '0' COMMENT '修改时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='节点转让申请';


INSERT INTO `gr_admin_rule` (`id`, `url`, `name`, `parent_id`, `sort`, `create_time`) VALUES 
(42,	'transfer/index',	'节点转让',	0,	0,	0),
(43,	'transfer/get-node-transfer,transfer/get-user-name-and-identify,transfer/create-transfer',	'转让申请',	42,	0,	0),
(44,	'transfer/get-transfer-detail,transfer/examine-on,transfer/examine-off',	'转让审核',	42,	0,	0),
(45,  'transfer/download', '转让导出', '42', 0, 0);


