(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3591"],{"/umX":function(t,a,e){"use strict";a.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(e("9dlP"));a.default=function(t,a,e){return a in t?(0,n.default)(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e,t}},"6HaC":function(t,a,e){"use strict";e.d(a,"a",function(){return o});var n=e("t3Un");function o(){return Object(n.a)({url:"/download/get-download-code",method:"post"})}},"9dlP":function(t,a,e){t.exports={default:e("I1YO"),__esModule:!0}},ACJA:function(t,a,e){"use strict";var n=e("fzjc");e.n(n).a},I1YO:function(t,a,e){e("NKWc");var n=e("fz6b").Object;t.exports=function(t,a,e){return n.defineProperty(t,a,e)}},NKWc:function(t,a,e){var n=e("yFux");n(n.S+n.F*!e("RqZd"),"Object",{defineProperty:e("anRQ").f})},Np98:function(t,a,e){"use strict";e.r(a);var n=e("6ZY3"),o=e.n(n),l=e("/umX"),i=e.n(l),r=e("bS4n"),c=e.n(r),d=e("YReu"),s=e.n(d),p=e("t3Un");function u(){return Object(p.a)({url:"/cycle/index",method:"post"})}var m=e("6HaC"),h=e("hrJr"),v={name:"PollManagement",data:function(){var t=this;return{search:"",searchDate:"",tableData:[],total:1,currentPage:1,order:null,dialogSet:!1,dialogSetData:[],pushSetData:[],dialogRank:!1,dialogRankAllType:[{value:0,label:"全部"},{value:1,label:"普通投票"},{value:2,label:"支付投票"},{value:3,label:"投票券"}],dialogRankType:0,dialogRankData:[],dialogRankDataPage:[],rankTotal:1,dialogRankDate:"",rankCurrentPage:1,dialogCamp:!1,dialogCampData:[],dialogAddCamp:!1,addCampForm:{camp:"",hold:"",id:""},addCampFormRules:{camp:[{required:!0,message:"请选择日期",trigger:"change"}],hold:[{validator:function(a,e,n){""===e||null===e?n(new Error("请输入日期")):new Date(t.addCampForm.hold[0]).getTime()<new Date(t.addCampForm.camp[1]).getTime()?n(new Error("任职日期必须在竞选结束后!")):n()},required:!0,trigger:"change"}]},dialogCampHistoryData:[],campTotal:1,campCurrentPage:1}},created:function(){this.init()},methods:{init:function(){var t=this;(function(t,a,e,n,o){return Object(p.a)({url:"/vote/index",method:"post",data:{searchName:t,page:a,str_time:e,end_time:n,order:o}})})(this.search,this.currentPage,this.searchDate[0],this.searchDate[1],this.order).then(function(a){t.tableData=a.content.list,t.total=a.content.count})},sortChange:function(t){this.currentPage=1,null===t.prop?this.order=null:"voteNumber"===t.prop&&"ascending"===t.order?this.order=1:"voteNumber"===t.prop&&"descending"===t.order?this.order=4:"type"===t.prop&&"ascending"===t.order?this.order=2:"type"===t.prop&&"descending"===t.order?this.order=5:"createTime"===t.prop&&"ascending"===t.order?this.order=3:"createTime"===t.prop&&"descending"===t.order&&(this.order=6),this.init()},searchTableData:function(){null===this.searchDate&&(this.searchDate=""),this.currentPage=1,this.init()},openVoteSet:function(){var t=this;Object(p.a)({url:"/vote/get-setting-list",method:"post"}).then(function(a){t.dialogSetData=a.content,t.pushSetData=[],t.dialogSetData.forEach(function(a,e,n){t.pushSetData.push(i()({},a.key,a.value.toString()))})}),this.dialogSet=!0},saveVoteSet:function(){var t=this,a={};this.pushSetData.map(function(t,e,n){o()(a,t)}),function(t){var a=s()(t,[]);return Object(p.a)({url:"/vote/set-vote",method:"post",data:c()({},a)})}(a).then(function(a){Object(h.Message)({message:a.msg,type:"success"}),t.dialogSet=!1})},initRank:function(){var t=this;(function(t,a,e){return Object(p.a)({url:"/vote/get-vote-order",method:"post",data:{end_time:t,type:a,page:e}})})(this.dialogRankDate,this.dialogRankType,this.rankCurrentPage).then(function(a){t.dialogRankData=a.content.list,t.rankTotal=a.content.count})},initCampHistory:function(){var t=this;(function(t){return Object(p.a)({url:"/cycle/history",method:"post",data:{page:t}})})(this.campCurrentPage).then(function(a){t.dialogCampHistoryData=a.content.list,t.campTotal=a.content.count})},openCamp:function(){var t=this;u().then(function(a){t.dialogCampData=a.content,t.dialogCamp=!0}),this.initCampHistory()},saveCamp:function(){var t=this;this.$refs.camp.validate(function(a){if(!a)return console.log("error submit!!"),!1;""===t.addCampForm.id?function(t,a,e,n){return Object(p.a)({url:"/cycle/create-cycle",method:"post",data:{cycleStartTime:t,cycleEndTime:a,tenureStartTime:e,tenureEndTime:n}})}(t.addCampForm.camp[0],t.addCampForm.camp[1],t.addCampForm.hold[0],t.addCampForm.hold[1]).then(function(a){Object(h.Message)({message:a.msg,type:"success"}),u().then(function(a){t.dialogCampData=a.content,t.dialogAddCamp=!1})}):function(t,a,e,n,o){return Object(p.a)({url:"/cycle/update-cycle",method:"post",data:{id:t,cycleStartTime:a,cycleEndTime:e,tenureStartTime:n,tenureEndTime:o}})}(t.addCampForm.id,t.addCampForm.camp[0],t.addCampForm.camp[1],t.addCampForm.hold[0],t.addCampForm.hold[1]).then(function(a){Object(h.Message)({message:a.msg,type:"success"}),u().then(function(a){t.dialogCampData=a.content,t.dialogAddCamp=!1})})})},openEditCamp:function(t){this.addCampForm.id=this.dialogCampData[t].id,this.addCampForm.camp=[],this.addCampForm.camp[0]=this.dialogCampData[t].cycleStartTime,this.addCampForm.camp[1]=this.dialogCampData[t].cycleEndTime,this.addCampForm.hold=[],this.addCampForm.hold[0]=this.dialogCampData[t].tenureStartTime,this.addCampForm.hold[1]=this.dialogCampData[t].tenureEndTime,this.dialogAddCamp=!0},delCamp:function(t){var a=this;this.$confirm("确定删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){(function(t){return Object(p.a)({url:"/cycle/del",method:"post",data:{id:t}})})(t).then(function(t){Object(h.Message)({message:t.msg,type:"success"}),u().then(function(t){a.dialogCampData=t.content})})})},downExcel:function(){var t=this;if(this.searchDate)var a=this.searchDate[0],e=this.searchDate[1];else a="",e="";Object(m.a)().then(function(n){var o="/vote/download?download_code="+n.content+"&searchName="+t.search+"&str_time="+a+"&end_time="+e,l=document.createElement("a");l.style.display="none",l.target="_blank",l.href=o,document.body.appendChild(l),l.click(),document.body.removeChild(l)})},downRankExcel:function(){var t=this;Object(m.a)().then(function(a){var e="/vote/vote-order-download?download_code="+a.content+"&type="+t.dialogRankType+"&end_time="+t.dialogRankDate,n=document.createElement("a");n.style.display="none",n.target="_blank",n.href=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)})}}},g=(e("ACJA"),e("ZrdR")),y=Object(g.a)(v,function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"app-container"},[e("h4",{staticStyle:{display:"inline-block"}},[t._v("投票管理")]),t._v(" "),e("el-button",{staticClass:"btn-right",on:{click:function(a){t.initRank(),t.dialogRank=!0}}},[t._v("投票排名")]),t._v(" "),e("el-button",{staticClass:"btn-right",staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:t.openVoteSet}},[t._v("投票设置")]),t._v(" "),e("el-button",{staticClass:"btn-right",on:{click:t.openCamp}},[t._v("竞选设置")]),t._v(" "),e("el-button",{staticClass:"btn-right",on:{click:t.downExcel}},[t._v("导出excel")]),t._v(" "),e("br"),t._v(" "),e("el-input",{staticStyle:{"margin-top":"20px",width:"300px"},attrs:{clearable:"",placeholder:"用户/节点名称"},on:{change:t.searchTableData},model:{value:t.search,callback:function(a){t.search=a},expression:"search"}},[e("el-button",{attrs:{slot:"append",icon:"el-icon-search"},nativeOn:{click:function(a){return t.searchTableData(a)}},slot:"append"})],1),t._v(" "),e("div",{staticStyle:{float:"right","margin-top":"20px"}},[t._v("\n    投票时间\n    "),e("el-date-picker",{staticStyle:{width:"400px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd"},on:{change:t.searchTableData},model:{value:t.searchDate,callback:function(a){t.searchDate=a},expression:"searchDate"}})],1),t._v(" "),e("br"),t._v(" "),e("el-table",{staticStyle:{margin:"10px 0"},attrs:{data:t.tableData},on:{"sort-change":t.sortChange}},[e("el-table-column",{attrs:{prop:"mobile",label:"投票用户"}}),t._v(" "),e("el-table-column",{attrs:{prop:"name",label:"投票节点"}}),t._v(" "),e("el-table-column",{attrs:{prop:"voteNumber",label:"投出票数",sortable:"custom"}}),t._v(" "),e("el-table-column",{attrs:{prop:"type",label:"投票方式",sortable:"custom"}}),t._v(" "),e("el-table-column",{attrs:{prop:"createTime",label:"投票时间",sortable:"custom"}})],1),t._v(" "),e("el-pagination",{attrs:{"current-page":t.currentPage,total:parseInt(t.total),"page-size":20,layout:"total, prev, pager, next, jumper"},on:{"update:currentPage":function(a){t.currentPage=a},"current-change":t.init}}),t._v(" "),e("el-dialog",{staticClass:"dialog-set",attrs:{visible:t.dialogSet,title:"投票设置"},on:{"update:visible":function(a){t.dialogSet=a}}},[t._l(t.dialogSetData,function(a,n){return e("div",{key:n},["radio"==a.type?e("div",{staticClass:"switch"},[e("span",[t._v(t._s(a.name))]),t._v(" "),e("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.pushSetData[n][a.key],callback:function(e){t.$set(t.pushSetData[n],a.key,e)},expression:"pushSetData[index][item.key]"}})],1):t._e(),t._v(" "),"text"==a.type?e("div",{staticClass:"txt"},[e("span",[t._v(t._s(a.name)+t._s(t.pushSetData[n][a.key]))])]):t._e(),t._v(" "),"input"==a.type?e("div",{staticClass:"item"},[e("span",{staticClass:"title"},[t._v(t._s(a.name))]),t._v(" "),e("el-input",{staticStyle:{width:"200px"},model:{value:t.pushSetData[n][a.key],callback:function(e){t.$set(t.pushSetData[n],a.key,e)},expression:"pushSetData[index][item.key]"}}),t._v(" "),e("span",[t._v(t._s(a.remark))])],1):t._e()])}),t._v(" "),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.saveVoteSet}},[t._v("确认修改")]),t._v(" "),e("el-button",{on:{click:function(a){t.dialogSet=!1}}},[t._v("取 消")])],1)],2),t._v(" "),e("el-dialog",{attrs:{visible:t.dialogCamp,fullscreen:!0,title:"竞选设置"},on:{"update:visible":function(a){t.dialogCamp=a}}},[t._l(t.dialogCampData,function(a,n){return e("div",{key:n},[e("h3",{staticStyle:{display:"inline-block"}},[t._v("投票竞选"+t._s(n+1))]),t._v(" "),e("el-button",{staticStyle:{float:"right"},attrs:{type:"danger",plain:""},on:{click:function(e){t.delCamp(a.id)}}},[t._v("删除")]),t._v(" "),e("el-button",{staticStyle:{float:"right","margin-right":"20px"},on:{click:function(a){t.openEditCamp(n)}}},[t._v("编辑")]),t._v(" "),e("br"),t._v(" "),e("div",{staticClass:"camp-info"},[e("div",[e("span",[t._v("竞选开始时间")]),t._v(" "),e("span",[t._v(t._s(a.cycleStartTime))])]),t._v(" "),e("div",[e("span",[t._v("竞选截止时间")]),t._v(" "),e("span",[t._v(t._s(a.cycleEndTime))])]),t._v(" "),e("div",[e("span",[t._v("任职开始时间")]),t._v(" "),e("span",[t._v(t._s(a.tenureStartTime))])]),t._v(" "),e("div",[e("span",[t._v("任职到期时间")]),t._v(" "),e("span",[t._v(t._s(a.tenureEndTime))])])])],1)}),t._v(" "),e("el-button",{staticStyle:{"margin-top":"20px"},on:{click:function(a){t.dialogAddCamp=!0}}},[t._v("+新增竞选投票")]),t._v(" "),e("el-dialog",{attrs:{visible:t.dialogAddCamp,title:"新增竞选投票",center:"","append-to-body":""},on:{"update:visible":function(a){t.dialogAddCamp=a},closed:function(a){t.addCampForm.camp="",t.addCampForm.hold="",t.addCampForm.id=""}}},[e("h3",[t._v("竞选投票")]),t._v(" "),e("el-form",{ref:"camp",attrs:{model:t.addCampForm,rules:t.addCampFormRules,"label-position":"top","label-width":"80px"}},[e("el-form-item",{attrs:{label:"竞选开始时间——竞选截止时间",prop:"camp"}},[e("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"竞选开始时间","end-placeholder":"竞选截止时间",format:"yyyy 年 MM 月 dd 日 HH:mm","value-format":"yyyy-MM-dd HH:mm"},model:{value:t.addCampForm.camp,callback:function(a){t.$set(t.addCampForm,"camp",a)},expression:"addCampForm.camp"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"任职开始时间——任职截止时间",prop:"hold"}},[e("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"竞选开始时间","end-placeholder":"竞选截止时间",format:"yyyy 年 MM 月 dd 日 HH:mm","value-format":"yyyy-MM-dd HH:mm"},model:{value:t.addCampForm.hold,callback:function(a){t.$set(t.addCampForm,"hold",a)},expression:"addCampForm.hold"}})],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.dialogAddCamp=!1}}},[t._v("取 消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.saveCamp}},[t._v("确 定")])],1)],1),t._v(" "),e("p",[t._v("历史记录")]),t._v(" "),e("el-table",{staticStyle:{margin:"10px 0"},attrs:{data:t.dialogCampHistoryData}},[e("el-table-column",{attrs:{prop:"id",label:"序号"}}),t._v(" "),e("el-table-column",{attrs:{prop:"cycleStartTime",label:"竞选开始时间"}}),t._v(" "),e("el-table-column",{attrs:{prop:"cycleEndTime",label:"竞选截止时间"}}),t._v(" "),e("el-table-column",{attrs:{prop:"tenureStartTime",label:"任职时间"}}),t._v(" "),e("el-table-column",{attrs:{prop:"tenureEndTime",label:"到期时间"}})],1),t._v(" "),e("el-pagination",{attrs:{"current-page":t.campCurrentPage,total:parseInt(t.campTotal),"page-size":20,layout:"total, prev, pager, next, jumper"},on:{"update:currentPage":function(a){t.campCurrentPage=a},"current-change":t.initCampHistory}})],2),t._v(" "),e("el-dialog",{attrs:{visible:t.dialogRank,title:"投票排名"},on:{"update:visible":function(a){t.dialogRank=a},closed:function(a){t.rankCurrentPage=1,t.dialogRankType=0,t.dialogRankDate=""}}},[e("el-select",{on:{change:function(a){t.rankCurrentPage=1,t.initRank()}},model:{value:t.dialogRankType,callback:function(a){t.dialogRankType=a},expression:"dialogRankType"}},t._l(t.dialogRankAllType,function(t,a){return e("el-option",{key:a,attrs:{label:t.label,value:t.value}})})),t._v(" "),e("el-button",{staticStyle:{float:"right"},on:{click:t.downRankExcel}},[t._v("导出excel")]),t._v(" "),e("div",{staticStyle:{"margin-top":"20px"}},[t._v("\n      截止时间\n      "),e("el-date-picker",{attrs:{type:"date",placeholder:"选择日期时间",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd"},on:{change:function(a){t.rankCurrentPage=1,t.initRank()}},model:{value:t.dialogRankDate,callback:function(a){t.dialogRankDate=a},expression:"dialogRankDate"}})],1),t._v(" "),e("el-table",{staticStyle:{margin:"10px 0"},attrs:{data:t.dialogRankData}},[e("el-table-column",{attrs:{prop:"order",label:"排名"}}),t._v(" "),e("el-table-column",{attrs:{prop:"mobile",label:"账号"}}),t._v(" "),e("el-table-column",{attrs:{prop:"num",label:"票数"}}),t._v(" "),e("el-table-column",{attrs:{label:"方式"},scopedSlots:t._u([{key:"default",fn:function(a){return[t._v("\n          "+t._s(t.dialogRankAllType[t.dialogRankType].label)+"\n        ")]}}])})],1),t._v(" "),e("el-pagination",{attrs:{"current-page":t.rankCurrentPage,total:parseInt(t.rankTotal),"page-size":20,layout:"total, prev, pager, next, jumper"},on:{"update:currentPage":function(a){t.rankCurrentPage=a},"current-change":t.initRank}})],1)],1)},[],!1,null,"ee79aa3e",null);y.options.__file="index.vue";a.default=y.exports},fzjc:function(t,a,e){}}]);